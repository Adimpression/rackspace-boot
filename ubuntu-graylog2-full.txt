#!/bin/sh
#
# Ubuntu Graylog2 initialization
# ===
# wget -O graylog.install https://raw.github.com/huksley/rackspace-boot/master/ubuntu-graylog2-full.txt && source graylog.install

ver=0.9.6p1

# prepare graylog

if [ ! -d /opt ]; then
  mkdir -p /opt
fi

cd /opt
if [ ! -d /opt/graylog2-server-$ver ]; then
  if [ ! -f graylog2-server-$ver.tar.gz ]; then
    wget -O graylog2-server-$ver.tar.gz https://github.com/downloads/Graylog2/graylog2-server/graylog2-server-$ver.tar.gz
  fi

  tar -xvf graylog2-server-$ver.tar.gz
  rm graylog2-server
  ln -s graylog2-server-$ver graylog2-server
fi

if [ ! -f /opt/graylog2-server/graylog2.conf ]; then
  cp /opt/graylog2-server/graylog2.conf.example /opt/graylog2-server/graylog2.conf
fi

rm /etc/init.d/graylog2-server 
ln -s /opt/graylog2-server/bin/graylog2ctl /etc/init.d/graylog2-server

# elasticsearch
wget -O elasticsearch.sh https://raw.github.com/gist/1190526/eb03b9c8c19d3d6157655e3d51d015d69e8d74e2/es.sh
sh elasticsearch.sh
/etc/init.d/elasticsearch start


